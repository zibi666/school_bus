# ğŸšŒ School Bus ç³»ç»Ÿå¸®åŠ©æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0 | **æœ€åæ›´æ–°**: 2025-12-17
> **é€‚ç”¨å¯¹è±¡**: å­¦ç”Ÿç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜ã€å¼€å‘äººå‘˜

**å­¦ç”Ÿæ±½è½¦åŒ…è½¦é¢„å®šç³»ç»Ÿ** æ˜¯ä¸€ä¸ªæ ¡å›­åœºæ™¯ä¸‹çš„åŒ…è½¦ç®¡ç†å¹³å°ï¼Œæ”¯æŒå­¦ç”Ÿåœ¨çº¿ç”³è¯·åŒ…è½¦ï¼Œç®¡ç†å‘˜å®¡æ ¸å’Œæ´¾è½¦ï¼Œå®ç°åŒ…è½¦ä¸šåŠ¡çš„è§„èŒƒåŒ–ã€ä¿¡æ¯åŒ–ç®¡ç†ã€‚

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#-ç³»ç»Ÿæ¦‚è¿°)
2. [ç”¨æˆ·ç±»å‹](#-ç”¨æˆ·ç±»å‹)
3. [æ ¸å¿ƒä¸šåŠ¡æµç¨‹ (å›¾è¡¨)](#-æ ¸å¿ƒä¸šåŠ¡æµç¨‹)
4. [å­¦ç”Ÿç«¯åŠŸèƒ½](#-å­¦ç”Ÿç«¯åŠŸèƒ½)
5. [ç®¡ç†å‘˜ç«¯åŠŸèƒ½](#-ç®¡ç†å‘˜ç«¯åŠŸèƒ½)
6. [æ•°æ®åº“è®¾è®¡](#-æ•°æ®åº“è®¾è®¡)
7. [APIæ¥å£](#-apiæ¥å£)
8. [å¸¸è§é—®é¢˜ (FAQ)](#-å¸¸è§é—®é¢˜)
9. [æ•…éšœæ’æŸ¥](#-æ•…éšœæ’æŸ¥)

---

## ğŸŒŸ ç³»ç»Ÿæ¦‚è¿°

### æ ¸å¿ƒç‰¹æ€§
- âœ… **åœ¨çº¿ç”³è¯·**ï¼šéšæ—¶éšåœ°æäº¤åŒ…è½¦éœ€æ±‚
- âš¡ **å¿«é€Ÿå®¡æ ¸**ï¼šç®¡ç†å‘˜å®æ—¶å¤„ç†ï¼Œæ´¾è½¦é«˜æ•ˆ
- ğŸ¤ **æ‹¼è½¦æœºåˆ¶**ï¼šç‹¬åˆ›**é‚€è¯·ç **ç³»ç»Ÿï¼Œæ”¯æŒå¤šäººåŠ å…¥åŒä¸€è®¢å•
- ğŸ”„ **çº§è”é€€ç¥¨**ï¼šç”³è¯·äººé€€ç¥¨è‡ªåŠ¨åŒæ­¥è‡³åŒç»„æ‰€æœ‰æˆå‘˜
- ğŸ›¡ï¸ **å†²çªæ£€æµ‹**ï¼šæ™ºèƒ½é˜²æ­¢è½¦è¾†æ—¶é—´å†²çª

### ä¸šåŠ¡æµå‘
```mermaid
graph LR
    A[ğŸ§‘â€ğŸ“ å­¦ç”Ÿç”³è¯·] --> B[â³ ç®¡ç†å‘˜å®¡æ ¸]
    B --> C{æ˜¯å¦é€šè¿‡?}
    C -- æ˜¯ --> D[ğŸšŒ åˆ†é…è½¦è¾†]
    D --> E[âœ… è®¢å•ç¡®è®¤]
    C -- å¦ --> F[âŒ è®¢å•æ‹’ç»]
    E --> G[ğŸ“Š ç®¡ç†ä¸è¿½è¸ª]
```

---

## ğŸ‘¥ ç”¨æˆ·ç±»å‹

### 1. ğŸ§‘â€ğŸ“ å­¦ç”Ÿç”¨æˆ·
ç³»ç»Ÿçš„ä¸»è¦ä½¿ç”¨è€…ã€‚
* **æ•°æ®è¡¨**: `student_info`

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `student_id` | **PK** | å­¦å· (ç™»å½•è´¦å·) |
| `name` | String | çœŸå®å§“å |
| `password` | String | åŠ å¯†å¯†ç  |
| `location` | String | å¸¸ç”¨æ‰€åœ¨åœ° |

### 2. ğŸ‘® ç®¡ç†å‘˜ç”¨æˆ·
ç³»ç»Ÿçš„åå°ç®¡ç†è€…ã€‚
* **æ•°æ®è¡¨**: `admin_info`

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `admin_id` | **PK** | å†…éƒ¨ID |
| `account` | String | ç™»å½•è´¦å· (é»˜è®¤: admin) |
| `password` | String | å¯†ç  (é»˜è®¤: 123456) |
| `name` | String | ç®¡ç†å‘˜å§“å |

---

## ğŸ”„ æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### åœºæ™¯ 1ï¼šå¤šäººæ‹¼è½¦ä¸é‚€è¯·ç é€»è¾‘
```mermaid
sequenceDiagram
    participant A as ç”³è¯·äºº (Student A)
    participant S as ç³»ç»Ÿ (System)
    participant B as åŠ å…¥è€… (Student B)
    participant Admin as ç®¡ç†å‘˜

    A->>S: 1. åˆ›å»ºè®¢å•
    S-->>A: ç”Ÿæˆé‚€è¯·ç  (e.g., ABC12345)
    Note right of A: ä»…ç”³è¯·äººå¯è§é‚€è¯·ç 

    A->>B: çº¿ä¸‹åˆ†äº«é‚€è¯·ç 
    B->>S: 2. è¾“å…¥é‚€è¯·ç åŠ å…¥
    S->>S: éªŒè¯æœ‰æ•ˆæ€§ & å¤åˆ¶è®¢å•ä¿¡æ¯
    S-->>B: åŠ å…¥æˆåŠŸ (çŠ¶æ€: å®¡æ ¸ä¸­)

    Admin->>S: 3. å®¡æ ¸é€šè¿‡ (åˆ†é…è½¦è¾† Bus-01)
    S-->>A: è®¢å•æ›´æ–°: å·²é€šè¿‡ (Bus-01)
    S-->>B: è®¢å•æ›´æ–°: å·²é€šè¿‡ (Bus-01)
```

### åœºæ™¯ 2ï¼šçº§è”é€€ç¥¨é€»è¾‘ (Refund Cascade)
> âš ï¸ **è­¦å‘Š**ï¼šé€€ç¥¨æ“ä½œå…·æœ‰ç ´åæ€§ï¼Œä¸€æ—¦æ‰§è¡Œï¼ŒåŒç»„æ‰€æœ‰äººçš„è®¢å•éƒ½å°†å¤±æ•ˆã€‚

```mermaid
graph TD
    A[ç”³è¯·äººç‚¹å‡»é€€ç¥¨] --> B{æ£€æŸ¥æƒé™}
    B -- is_applicant=1 --> C[æ‰§è¡Œçº§è”æ›´æ–°]
    C --> D[æŸ¥æ‰¾åŒé‚€è¯·ç æ‰€æœ‰è®¢å•]
    D --> E[æ›´æ–° ç”³è¯·äºº è®¢å• -> å·²é€€ç¥¨]
    D --> F[æ›´æ–° åŠ å…¥è€…A è®¢å• -> å·²é€€ç¥¨]
    D --> G[æ›´æ–° åŠ å…¥è€…B è®¢å• -> å·²é€€ç¥¨]
    B -- is_applicant=0 --> H[âŒ æ‹’ç»æ“ä½œ]
```

---

## ğŸ“ ç³»ç»Ÿ UML å›¾è¡¨

### 1. å®ä½“å…³ç³»å›¾ (ER Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  student_info   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ student_id (PK) â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ name            â”‚       â”‚
â”‚ password        â”‚       â”‚
â”‚ location        â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ admin_info  â”‚    â”‚  t_order    â”‚  â”‚ 1å¯¹å¤š
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ admin_id(PK)â”œâ”€â”€â”€â–ºâ”‚ order_id(PK)â”‚â—„â”€â”˜
â”‚ account(UK) â”‚    â”‚ student_id  â”‚
â”‚ password    â”‚    â”‚ bus_id      â”‚
â”‚ name        â”‚    â”‚ status      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ price       â”‚
                   â”‚ invitation_ â”‚
                   â”‚ code â­     â”‚
                   â”‚ is_applicantâ”‚â­
                   â”‚ start_time  â”‚
                   â”‚ end_time    â”‚
                   â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ 1å¯¹å¤š
                   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚    t_bus       â”‚  â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
              â”‚ bus_id (PK)    â”œâ”€â”€â”˜
              â”‚ plate_number   â”‚
              â”‚ car_type       â”‚
              â”‚ driver_name    â”‚
              â”‚ price/hour     â”‚
              â”‚ number         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç³»ç»Ÿç”¨ä¾‹å›¾ (Use Case Diagram)

```
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         ğŸ§‘â€ğŸ“ å­¦ç”Ÿç”¨æˆ·                   â”‚
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚ â€¢ ğŸ” ç™»å½•/æ³¨å†Œ                         â”‚
                      â”‚ â€¢ ğŸ“ åˆ›å»ºè®¢å• (ç”Ÿæˆé‚€è¯·ç )             â”‚
                      â”‚ â€¢ ğŸ¤ åŠ å…¥è®¢å• (ä½¿ç”¨é‚€è¯·ç )             â”‚
                      â”‚ â€¢ ğŸ’¸ æ”¯ä»˜è®¢å•                          â”‚
                      â”‚ â€¢ ğŸ“± æŸ¥çœ‹æˆ‘çš„è®¢å•                      â”‚
                      â”‚ â€¢ ğŸ”„ ç”³è¯·é€€ç¥¨ (çº§è”)                   â”‚
                      â”‚ â€¢ ğŸšª ç¦»å¼€è®¢å• (ä»…åŠ å…¥è€…)               â”‚
                      â”‚ â€¢ ğŸ‘¤ ä¸ªäººèµ„æ–™                          â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚       ğŸ‘® ç®¡ç†å‘˜ç”¨æˆ·                    â”‚
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚ â€¢ ğŸ” ç®¡ç†å‘˜ç™»å½•                        â”‚
                      â”‚ â€¢ ğŸ“‹ æŸ¥çœ‹è®¢å•åˆ—è¡¨                      â”‚
                      â”‚ â€¢ âœ… å®¡æ ¸é€šè¿‡ (åˆ†é…è½¦è¾†)               â”‚
                      â”‚ â€¢ âŒ å®¡æ ¸æ‹’ç» (è®°å½•åŸå› )                â”‚
                      â”‚ â€¢ ğŸ”„ æ’¤é”€è®¢å• (é‡Šæ”¾è½¦è¾†)                â”‚
                      â”‚ â€¢ ğŸšŒ è½¦è¾†ç®¡ç† (å¢åˆ æ”¹æŸ¥)                â”‚
                      â”‚ â€¢ âš ï¸  æ—¶é—´å†²çªæ£€æŸ¥                     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚        âš™ï¸ ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½                â”‚
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚ â€¢ é‚€è¯·ç ç”Ÿæˆ (8ä½éšæœºç )              â”‚
                      â”‚ â€¢ æ—¶é—´å†²çªæ£€æŸ¥ (æ™ºèƒ½æ´¾è½¦)              â”‚
                      â”‚ â€¢ çº§è”æ›´æ–° (æ‰¹é‡æ“ä½œ)                  â”‚
                      â”‚ â€¢ æƒé™éªŒè¯ (è§’è‰²æ£€æŸ¥)                  â”‚
                      â”‚ â€¢ ä»·æ ¼è®¡ç®— (æ—¶é—´Ã—å•ä»·)                 â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. è®¢å•çŠ¶æ€æµè½¬å›¾ (State Diagram)

```mermaid
graph TD
    Start([å¼€å§‹])
    Start --> A["ğŸŸ¡ å®¡æ ¸ä¸­"]
    
    A -->|ç®¡ç†å‘˜é€šè¿‡ + åˆ†é…è½¦è¾†| B["ğŸŸ¢ å·²é€šè¿‡"]
    A -->|ç®¡ç†å‘˜æ‹’ç» æˆ– å­¦ç”Ÿå–æ¶ˆ| C["ğŸ”´ å·²æ‹’ç»"]
    
    B -->|ç”³è¯·äººç”³è¯·é€€ç¥¨ çº§è”æ›´æ–°| D["âš« å·²é€€ç¥¨"]
    B -->|ç®¡ç†å‘˜æ’¤é”€ æˆ– è½¦è¾†åˆ é™¤| C
    
    C --> End([ç»“æŸ])
    D --> End
    
    A -.æè¿°.-> N1["å­¦ç”Ÿå¯ä»¥å–æ¶ˆè®¢å•<br/>ä»…é™ is_applicant=1"]
    B -.æè¿°.-> N2["è½¦è¾†å·²åˆ†é… bus_id != null<br/>ç”³è¯·äººå¯ç”³è¯·é€€ç¥¨<br/>åŠ å…¥è€…æ— æ³•ç”³è¯·é€€ç¥¨"]
    D -.æè¿°.-> N3["çº§è”æ“ä½œ: åŒé‚€è¯·ç æ‰€æœ‰è®¢å•å˜ä¸ºå·²é€€ç¥¨<br/>ç»ˆç»“æ€§æ“ä½œï¼Œä¸å¯é€†è½¬"]
    C -.æè¿°.-> N4["ç®¡ç†å‘˜æ‹’ç» + åŸå› è®°å½•<br/>æˆ–å› è½¦è¾†åˆ é™¤è‡ªåŠ¨æ‹’ç»<br/>æˆ–å­¦ç”Ÿä¸»åŠ¨å–æ¶ˆ"]
    
    style A fill:#FFE082,stroke:#FBC02D,color:#000
    style B fill:#81C784,stroke:#558B2F,color:#fff
    style C fill:#E57373,stroke:#C62828,color:#fff
    style D fill:#424242,stroke:#000,color:#fff
```

### 4. æ ¸å¿ƒå®ä½“ç±»å…³ç³» (Class Relationship)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Student (å­¦ç”Ÿ)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - student_id: String PK  â”‚
â”‚ - name: String           â”‚
â”‚ - password: String       â”‚
â”‚ - location: String       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1å¯¹å¤š
         â”‚ åˆ›å»º/åŠ å…¥
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       Order (è®¢å•) â­              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - order_id: int PK                â”‚
    â”‚ - student_id: String FK           â”‚
    â”‚ - destination: String             â”‚
    â”‚ - requested_car_type: String      â”‚
    â”‚ - bus_id: int FK                  â”‚
    â”‚ - price: decimal                  â”‚
    â”‚ - status: String                  â”‚
    â”‚ - invitation_code: String â­      â”‚
    â”‚ - start_time: datetime            â”‚
    â”‚ - end_time: datetime              â”‚
    â”‚ - is_applicant: boolean â­        â”‚
    â”‚                                   â”‚
    â”‚ + createOrder()                   â”‚
    â”‚ + joinByCode()                    â”‚
    â”‚ + refund()                        â”‚
    â”‚ + leaveOrder()                    â”‚
    â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ 1å¯¹å¤š (åˆ†é…è½¦è¾†)           â”‚ å¤šå¯¹1 (ç®¡ç†å‘˜å®¡æ ¸)
      â”‚                            â”‚
    â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Bus (è½¦è¾†)          â”‚  â”‚   Admin (ç®¡ç†å‘˜)      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - bus_id: int PK    â”‚  â”‚ - admin_id: int PK â”‚
    â”‚ - plate_number: Str â”‚  â”‚ - account: String  â”‚
    â”‚ - car_type: String  â”‚  â”‚ - password: String â”‚
    â”‚ - driver_name: Str  â”‚  â”‚ - name: String     â”‚
    â”‚ - price: int        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ - number: String    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

API è¿”å›æ ¼å¼ç»Ÿä¸€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ApiResponse<T>           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - code: int (200/400/401...) â”‚
â”‚ - message: String           â”‚
â”‚ - data: T (æ³›å‹æ•°æ®)         â”‚
â”‚                             â”‚
â”‚ + success(data)             â”‚
â”‚ + error(code, message)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. æ•°æ®åº“è¡¨å…³ç³»

```
ç”¨æˆ·ç®¡ç†                           ä¸šåŠ¡æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ student_info    â”‚               â”‚  t_order     â”‚â—„â”€â”€â”€ â­ æ ¸å¿ƒè¡¨
â”‚ å­¦ç”Ÿè¡¨          â”‚â—„â”€â”€â”           â”‚  è®¢å•è¡¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚              â”‚
                      â”œâ”€â”€â†’ å¤–é”® â”€â”€â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚ å…³é”®å­—æ®µ:     â”‚
â”‚ admin_info      â”‚â—„â”€â”€â”˜           â”‚ â€¢ invitation_â”‚
â”‚ ç®¡ç†å‘˜è¡¨        â”‚               â”‚   code (é‚€è¯·ç )
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â€¢ is_applic- â”‚
                                  â”‚   ant (èº«ä»½)  â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â–²
                                        â”‚ 1å¯¹å¤š
                                        â”‚ (åŒé‚€è¯·ç )
                                        â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  t_bus       â”‚
                      â”‚  è½¦è¾†è¡¨      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é‡è¦ç´¢å¼•ï¼š
â€¢ idx_order_bus_time (bus_id, start_time, end_time, status)
  â””â”€ ç”¨äº: æ—¶é—´å†²çªæ£€æŸ¥
  
â€¢ idx_invitation_code_status (invitation_code, status)
  â””â”€ ç”¨äº: é‚€è¯·ç æŸ¥è¯¢ã€çº§è”æ›´æ–°
```

### 6. æ—¶é—´å†²çªæ£€æŸ¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç®¡ç†å‘˜é€‰æ‹©è½¦è¾†å¹¶ç‚¹å‡»ã€å®¡æ ¸é€šè¿‡ã€‘        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸæŸ¥è¯¢è¯¥è½¦è¾†åœ¨æŒ‡å®šæ—¶é—´æ®µå†…çš„è®¢å•      â”‚
â”‚ SQL: SELECT COUNT(*) FROM t_order      â”‚
â”‚ WHERE bus_id = ? AND status = 'å·²é€šè¿‡'  â”‚
â”‚   AND start_time < ? AND end_time > ?  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 0æ¡å†²çª â”‚   â”‚ â‰¥1æ¡å†²çª  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚
        â–¼              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ âœ…æ— å†²çª â”‚   â”‚ âŒ æ—¶é—´å†²çª   â”‚
   â”‚åˆ†é…æˆåŠŸ  â”‚   â”‚æç¤ºç®¡ç†å‘˜é€‰æ‹© â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚å…¶ä»–è½¦è¾†      â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½ä¼˜åŒ–:
â€¢ ä½¿ç”¨å¤åˆç´¢å¼• idx_order_bus_time
â€¢ å¿«é€Ÿå®šä½å†²çªè®¢å•
â€¢ é¿å…å…¨è¡¨æ‰«æ
```

---

## ğŸ“± å­¦ç”Ÿç«¯åŠŸèƒ½

### 1. è®¢å•çŠ¶æ€å›¾ä¾‹

| çŠ¶æ€æ ‡è®° | çŠ¶æ€åç§° | å«ä¹‰ | å…è®¸æ“ä½œ |
| :---: | :--- | :--- | :--- |
| ğŸŸ¡ | **å®¡æ ¸ä¸­** | è®¢å•å·²æäº¤ï¼Œç­‰å¾…ç®¡ç†å‘˜å¤„ç† | å–æ¶ˆè®¢å• |
| ğŸŸ¢ | **å·²é€šè¿‡** | è½¦è¾†å·²åˆ†é…ï¼Œå‡†å¤‡å‡ºè¡Œ | æŸ¥çœ‹è½¦è¾†ã€**ç”³è¯·é€€ç¥¨** |
| ğŸ”´ | **å·²æ‹’ç»** | ç®¡ç†å‘˜é©³å›æˆ–ç³»ç»Ÿè‡ªåŠ¨å–æ¶ˆ | æŸ¥çœ‹æ‹’ç»åŸå›  |
| âš« | **å·²é€€ç¥¨** | ç”³è¯·äººå‘èµ·é€€ç¥¨ï¼Œæµç¨‹ç»ˆæ­¢ | æ—  |

### 2. å…³é”®åŠŸèƒ½æŒ‡å—

#### ğŸŸï¸ é€šè¿‡é‚€è¯·ç åŠ å…¥
1.  è·å–ä»–äººåˆ†äº«çš„ **8ä½é‚€è¯·ç **ã€‚
2.  è¿›å…¥â€œåŠ å…¥åŒ…è½¦â€é¡µé¢è¾“å…¥ä»£ç ã€‚
3.  **æ³¨æ„**ï¼šåŠ å…¥è€…ä¸ç”³è¯·äººå…±äº«åŒä¸€è¾†è½¦ï¼Œä¸”**æ— æ³•å†æ¬¡æŸ¥çœ‹é‚€è¯·ç **ï¼Œä¹Ÿæ— æƒå‘èµ·é€€ç¥¨ã€‚

#### ğŸ’¸ ç”³è¯·é€€ç¥¨
* **å‰ç½®æ¡ä»¶**ï¼š
    * å¿…é¡»æ˜¯ **ç”³è¯·äºº** (`is_applicant=1`)
    * è®¢å•çŠ¶æ€ä¸º **å·²é€šè¿‡**
* **åæœ**ï¼šè¯¥é‚€è¯·ç ä¸‹çš„**æ‰€æœ‰å­¦ç”Ÿ**è®¢å•éƒ½ä¼šå˜ä¸ºâ€œå·²é€€ç¥¨â€ã€‚

---

## ğŸ’» ç®¡ç†å‘˜ç«¯åŠŸèƒ½

### 1. è®¢å•å®¡æ ¸
* **é€šè¿‡ (Approve)**ï¼š
    * ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ—å‡º**æ— æ—¶é—´å†²çª**çš„å¯ç”¨è½¦è¾†ã€‚
    * è‹¥æ— è½¦å¯ç”¨ï¼Œè¯·é€‰æ‹©æ‹’ç»ã€‚
* **æ‹’ç» (Reject)**ï¼š
    * å¿…é¡»å¡«å†™æ‹’ç»ç†ç”±ï¼ˆå¦‚ï¼šâ€œè½¦è¾†ä¸è¶³â€ã€â€œç”±äºå¤©æ°”åŸå› å–æ¶ˆâ€ï¼‰ã€‚

### 2. è½¦è¾†ç®¡ç†
åˆ é™¤è½¦è¾†æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œ**è½¯å¤„ç†**ï¼š
> ğŸ’¡ **é€»è¾‘**ï¼šåˆ é™¤è½¦è¾† -> ç³»ç»Ÿè‡ªåŠ¨æŸ¥æ‰¾è¯¥è½¦è¾†æ‰€æœ‰â€œå®¡æ ¸ä¸­/å·²é€šè¿‡â€è®¢å• -> å°†çŠ¶æ€æ”¹ä¸ºâ€œå·²æ‹’ç»â€ -> ç†ç”±è‡ªåŠ¨å¡«å…¥â€œè½¦è¾†å·²åˆ é™¤â€ã€‚

---

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ï¼š`t_order`
è¿™æ˜¯ç³»ç»Ÿæœ€å…³é”®çš„è¡¨ï¼Œæ‰¿è½½äº†æ‹¼è½¦å’ŒçŠ¶æ€æµè½¬é€»è¾‘ã€‚

```sql
CREATE TABLE `t_order` (
  `order_id` int(11) NOT NULL AUTO_INCREMENT,
  `student_id` varchar(20) NOT NULL COMMENT 'ç”³è¯·äººå­¦å·',
  `destination` varchar(255) NOT NULL COMMENT 'ç›®çš„åœ°',
  `requested_car_type` varchar(255) NOT NULL COMMENT 'éœ€æ±‚è½¦å‹',
  `bus_id` int(11) DEFAULT NULL COMMENT 'åˆ†é…è½¦è¾†ID',
  `price` decimal(10,2) DEFAULT NULL COMMENT 'è®¢å•è´¹ç”¨',
  `status` varchar(20) DEFAULT 'å®¡æ ¸ä¸­' COMMENT 'çŠ¶æ€',
  `reject_reason` varchar(255) DEFAULT NULL COMMENT 'æ‹’ç»ç†ç”±',
  `invitation_code` varchar(20) DEFAULT NULL COMMENT 'å…³é”®ï¼šé‚€è¯·ç ',
  `start_time` datetime DEFAULT NULL,
  `end_time` datetime DEFAULT NULL,
  `is_applicant` tinyint(4) NOT NULL DEFAULT '1' COMMENT '1=å‘èµ·äºº, 0=åŠ å…¥è€…',
  PRIMARY KEY (`order_id`),
  /* è”åˆå”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤æäº¤ */
  UNIQUE INDEX `idx_order_unique` (`student_id`, `invitation_code`, `bus_id`, `start_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

---

## ğŸ”Œ APIæ¥å£

| æ¨¡å— | æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- | :--- |
| **Auth** | `POST` | `/api/auth/student/login` | å­¦ç”Ÿç™»å½• |
| **Order** | `POST` | `/api/student/order` | åˆ›å»ºæ–°è®¢å• (ç”Ÿæˆé‚€è¯·ç ) |
| **Order** | `POST` | `/api/student/order/join` | **åŠ å…¥è®¢å• (ä½¿ç”¨é‚€è¯·ç )** |
| **Order** | `POST` | `/api/student/order/refund/{id}` | **ç”³è¯·é€€ç¥¨ (çº§è”)** |
| **Admin** | `POST` | `/api/admin/order/approve` | å®¡æ ¸é€šè¿‡å¹¶æ´¾è½¦ |

> ğŸ“– å®Œæ•´æ–‡æ¡£è¯·å‚é˜…é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `API_REQUIREMENTS.md`

---

## â“ å¸¸è§é—®é¢˜

<details>
<summary><strong>Q1: é‚€è¯·ç æ˜¯ä»€ä¹ˆï¼Ÿåœ¨å“ªçœ‹ï¼Ÿ</strong></summary>
<br>
é‚€è¯·ç æ˜¯ç³»ç»Ÿä¸ºæ¯ä¸ªæ–°è®¢å•è‡ªåŠ¨ç”Ÿæˆçš„ 8 ä½éšæœºå­—ç¬¦ï¼ˆå¦‚ `ABC12345`ï¼‰ã€‚
<br>
<strong>åªæœ‰è®¢å•çš„â€œç”³è¯·äººâ€</strong>å¯ä»¥åœ¨â€œæˆ‘çš„è®¢å•â€è¯¦æƒ…ä¸­çœ‹åˆ°é‚€è¯·ç ã€‚åŠ å…¥è€…æ— æ³•æŸ¥çœ‹ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢é‚€è¯·ç è¢«éšæ„æ³„éœ²ã€‚
</details>

<details>
<summary><strong>Q2: ä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½ç”³è¯·é€€ç¥¨ï¼Ÿ</strong></summary>
<br>
è¯·æ£€æŸ¥ä»¥ä¸‹ä¸¤ç‚¹ï¼š
<ol>
    <li>æ‚¨æ˜¯å¦æ˜¯è®¢å•çš„<strong>åŠ å…¥è€…</strong>ï¼Ÿåªæœ‰å‘èµ·è®¢å•çš„â€œç”³è¯·äººâ€æ‰æœ‰æƒé€€ç¥¨ã€‚</li>
    <li>è®¢å•çŠ¶æ€æ˜¯å¦ä¸ºâ€œå·²é€šè¿‡â€ï¼Ÿåªæœ‰å·²é€šè¿‡çš„è®¢å•éœ€è¦é€€ç¥¨ï¼Œå®¡æ ¸ä¸­çš„è®¢å•ç›´æ¥å–æ¶ˆå³å¯ã€‚</li>
</ol>
</details>

<details>
<summary><strong>Q3: é€€ç¥¨åè¿˜èƒ½æ¢å¤å—ï¼Ÿ</strong></summary>
<br>
<strong>ä¸èƒ½è‡ªåŠ©æ¢å¤ã€‚</strong> é€€ç¥¨æ“ä½œæ˜¯ç»ˆç»“æ€§çš„ã€‚å¦‚æœè¯¯æ“ä½œï¼Œè¯·ç«‹å³è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜éœ€è¦åœ¨æ•°æ®åº“åå°æˆ–é€šè¿‡ç‰¹æ®Šæ¥å£æ‰‹åŠ¨å¹²é¢„ã€‚
</details>

---

## ğŸ”§ æ•…éšœæ’æŸ¥

<details>
<summary><strong>ğŸ”´ é—®é¢˜ï¼šç®¡ç†å‘˜æ´¾è½¦æ—¶æç¤ºâ€œæ—¶é—´å†²çªâ€</strong></summary>
<br>
<strong>åŸå› </strong>ï¼šæ‚¨è¯•å›¾åˆ†é…çš„è½¦è¾†ï¼Œåœ¨å½“å‰è®¢å•çš„ <code>start_time</code> å’Œ <code>end_time</code> èŒƒå›´å†…ï¼Œå·²ç»å­˜åœ¨å¦ä¸€ä¸ªçŠ¶æ€ä¸ºâ€œå·²é€šè¿‡â€çš„è®¢å•ã€‚<br>
<strong>è§£å†³</strong>ï¼šè¯·é€‰æ‹©å…¶ä»–è½¦è¾†ï¼Œæˆ–è€…å…ˆæ’¤é”€é‚£ä¸ªå†²çªçš„æ—§è®¢å•ã€‚
</details>

<details>
<summary><strong>ğŸ”´ é—®é¢˜ï¼šåŠ å…¥è®¢å•æç¤ºâ€œé‚€è¯·ç æ— æ•ˆâ€</strong></summary>
<br>
<strong>åŸå› </strong>ï¼š
<ul>
    <li>é‚€è¯·ç è¾“å…¥é”™è¯¯ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚</li>
    <li>åŸè®¢å•å·²è¢«æ‹’ç»æˆ–å·²é€€ç¥¨ï¼ˆé‚€è¯·ç éšä¹‹å¤±æ•ˆï¼‰ã€‚</li>
    <li>æ‚¨å·²ç»åœ¨è¿™ä¸ªè®¢å•é‡Œäº†ï¼ˆä¸èƒ½é‡å¤åŠ å…¥ï¼‰ã€‚</li>
</ul>
</details>

---

> **è·å–æ›´å¤šå¸®åŠ©**
>
> * ğŸ“– **APIæµ‹è¯•æŒ‡å—**: è§ `APIFOX_TEST_GUIDE.md`
> * ğŸ“ **é€€ç¥¨é€»è¾‘è¯´æ˜**: è§ `REFUND_IMPLEMENTATION_GUIDE.md`
> * ğŸ› ï¸ **æŠ€æœ¯æ”¯æŒ**: è¯·è”ç³»å¼€å‘å›¢é˜Ÿ