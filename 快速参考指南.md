# æ ¡è½¦é¢„çº¦ç³»ç»Ÿ - å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æ–°æ‰‹å…¥é—¨
1. å…ˆé˜…è¯» [README.md](README.md) - é¡¹ç›®æ€»ä½“ä»‹ç»
2. å†é˜…è¯» [CODE_DOCUMENTATION.md](CODE_DOCUMENTATION.md) - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
3. æŸ¥çœ‹ [API_REQUIREMENTS.md](code/backend/school_bus/API_REQUIREMENTS.md) - APIæ¥å£æ¸…å•

### æ·±å…¥å­¦ä¹ 
- [ä»£ç æ³¨é‡Šå®ŒæˆæŠ¥å‘Š.md](ä»£ç æ³¨é‡Šå®ŒæˆæŠ¥å‘Š.md) - ä»£ç æ³¨é‡Šå®Œæˆæƒ…å†µ
- [å¦‚ä½•åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½²springbootåç«¯.md](doc/å¦‚ä½•åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½²springbootåç«¯.md) - éƒ¨ç½²æŒ‡å—

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### é‚€è¯·ç ç³»ç»Ÿ
```
ç”³è¯·äººåˆ›å»ºè®¢å• â†’ ç³»ç»Ÿç”Ÿæˆé‚€è¯·ç  â†’ å…¶ä»–å­¦ç”Ÿè¾“å…¥é‚€è¯·ç åŠ å…¥
                                  â†“
                        å¤šä¸ªå­¦ç”Ÿå…±äº«ä¸€ä¸ªè¡Œç¨‹
                                  â†“
                ç”³è¯·äººé€€ç¥¨ â†’ æ‰€æœ‰åŠ å…¥è€…ä¹Ÿè¢«æ ‡è®°ä¸º"å·²é€€ç¥¨"
```

**å…³é”®æ–‡ä»¶**ï¼š
- `service/StudentService.java` (300+è¡Œæ³¨é‡Š)
- `mapper/OrderMapper.java` (80+è¡Œæ³¨é‡Š)
- `mapper/OrderMapper.xml` (120+è¡Œæ³¨é‡Š)

### è®¢å•å®¡æ ¸æµç¨‹
```
1. å­¦ç”Ÿåˆ›å»ºè®¢å• (status=å®¡æ ¸ä¸­)
         â†“
2. å­¦ç”Ÿæ”¯ä»˜è®¢å• (is_paid=true)
         â†“
3. ç®¡ç†å‘˜å®¡æ ¸
   â”œâ”€ é€šè¿‡: åˆ†é…è½¦è¾† (status=å·²é€šè¿‡)
   â””â”€ æ‹’ç»: è®°å½•åŸå›  (status=å·²æ‹’ç»)
```

**å…³é”®æ–‡ä»¶**ï¼š
- `service/AdminService.java` (200+è¡Œæ³¨é‡Š)
- `controller/AdminController.java` (120+è¡Œæ³¨é‡Š)

---

## ğŸ” ä»£ç æŸ¥æ‰¾é€ŸæŸ¥è¡¨

| éœ€æ±‚ | æ–‡ä»¶ | è¡Œæ•° |
|------|------|------|
| **è®¤è¯ç›¸å…³** | | |
| å­¦ç”Ÿç™»å½• | `controller/AuthController.java` | ~20 |
| ç®¡ç†å‘˜ç™»å½• | `controller/AuthController.java` | ~20 |
| ç™»å½•ä¸šåŠ¡é€»è¾‘ | `service/AuthService.java` | 50+ |
| **å­¦ç”Ÿè®¢å•** | | |
| åˆ›å»ºè®¢å• | `controller/StudentController.java:createOrder()` | ~30 |
| åˆ›å»ºè®¢å•ä¸šåŠ¡ | `service/StudentService.java:createOrder()` | 100+ |
| é‚€è¯·ç åŠ å…¥ | `controller/StudentController.java:joinByCode()` | ~20 |
| é‚€è¯·ç åŠ å…¥ä¸šåŠ¡ | `service/StudentService.java:joinOrderByInvitationCode()` | 80+ |
| é€€ç¥¨ | `controller/StudentController.java:refund()` | ~15 |
| é€€ç¥¨ä¸šåŠ¡ï¼ˆçº§è”ï¼‰ | `service/StudentService.java:refundOrder()` | 50+ |
| **ç®¡ç†å‘˜è®¢å•** | | |
| å®¡æ ¸é€šè¿‡ | `service/AdminService.java:approveOrder()` | 80+ |
| æ—¶é—´å†²çªæ£€æŸ¥ | `mapper/OrderMapper.java:checkTimeConflict()` | 30+ |
| æ—¶é—´å†²çªSQL | `mapper/OrderMapper.xml:checkTimeConflict` | ~30 |
| **æ•°æ®åº“** | | |
| é‚€è¯·ç æŸ¥è¯¢ | `mapper/OrderMapper.xml:selectByInvitationCodeAll` | ~20 |
| çº§è”æ›´æ–° | `mapper/OrderMapper.xml:updateStatusByInvitationCode` | ~20 |

---

## ğŸš€ å¿«é€Ÿå¼€å‘

### æ–°å¢ä¸€ä¸ªå­¦ç”Ÿç«¯åŠŸèƒ½

1. **åˆ›å»ºControlleræ–¹æ³•**
   ```java
   @PostMapping("/student/feature")
   public ApiResponse<Result> feature(@RequestParam ...) {
       // 1. å‚æ•°éªŒè¯
       // 2. è°ƒç”¨Service
       // 3. è¿”å›ç»“æœ
       return ApiResponse.success(result);
   }
   ```
   å‚è€ƒï¼š`StudentController.java` çš„ç«¯ç‚¹

2. **åˆ›å»ºServiceæ–¹æ³•**
   ```java
   public Result feature(params) {
       // 1. ä¸šåŠ¡é€»è¾‘
       // 2. å¼‚å¸¸å¤„ç†ï¼ˆthrow new BusinessException(code, message)ï¼‰
       // 3. è¿”å›ç»“æœ
   }
   ```
   å‚è€ƒï¼š`StudentService.java` çš„æ–¹æ³•å®ç°

3. **åˆ›å»ºMapperæ–¹æ³•**
   ```java
   // Mapperæ¥å£ä¸­æ·»åŠ æ–¹æ³•å£°æ˜
   Result selectXxx(params);
   
   // XMLä¸­æ·»åŠ SQLæ˜ å°„
   <select id="selectXxx" parameterType="..." resultMap="...">
       SELECT ... WHERE ...
   </select>
   ```
   å‚è€ƒï¼š`OrderMapper.java` å’Œ `OrderMapper.xml`

4. **å‰ç«¯è°ƒç”¨**
   ```javascript
   // åœ¨ api/index.js ä¸­æ·»åŠ 
   export const featureApi = (data) => api.post('/student/feature', data)
   
   // åœ¨ç»„ä»¶ä¸­è°ƒç”¨
   import { featureApi } from '@/api'
   const result = await featureApi(data)
   ```
   å‚è€ƒï¼š`api/index.js` çš„APIå‡½æ•°

---

## ğŸ“ å¸¸ç”¨ä»£ç ç‰‡æ®µ

### ä¸šåŠ¡å¼‚å¸¸å¤„ç†
```java
// å‚æ•°æ£€æŸ¥
if (order == null) {
    throw new BusinessException(404, "è®¢å•ä¸å­˜åœ¨");
}

// æƒé™æ£€æŸ¥
if (!order.getIsApplicant()) {
    throw new BusinessException(403, "åªæœ‰ç”³è¯·äººæ‰èƒ½é€€ç¥¨");
}

// çŠ¶æ€æ£€æŸ¥
if (!"å®¡æ ¸ä¸­".equals(order.getStatus())) {
    throw new BusinessException(400, "è®¢å•çŠ¶æ€é”™è¯¯ï¼Œæ— æ³•æ”¯ä»˜");
}
```

### APIå“åº”
```java
// æˆåŠŸå“åº”
return ApiResponse.success(data);

// é”™è¯¯å“åº”ï¼ˆä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå¼‚å¸¸ï¼‰
throw new BusinessException(400, "é”™è¯¯æ¶ˆæ¯");
```

### æ—¶é—´è®¡ç®—
```java
// ä½¿ç”¨PriceCalculator
double hours = PriceCalculator.calculateHours(startTime, endTime);
BigDecimal price = PriceCalculator.calculatePrice(hours, hourlyRate);
String formatted = PriceCalculator.formatHours(hours); // "5å°æ—¶30åˆ†é’Ÿ"
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### è¿½è¸ªé‚€è¯·ç æµç¨‹

1. **åˆ›å»ºè®¢å•**
   - æŸ¥çœ‹æ•°æ®åº“ `t_order` è¡¨ï¼Œæ‰¾åˆ°æ–°åˆ›å»ºçš„è®°å½•
   - æ£€æŸ¥ `invitation_code` å’Œ `is_applicant` å­—æ®µ

2. **åŠ å…¥æ‹¼è½¦**
   - åˆ›å»ºæ–°å­¦ç”Ÿçš„Orderè®°å½•
   - æ£€æŸ¥ `invitation_code` æ˜¯å¦ä¸ç”³è¯·äººç›¸åŒ
   - æ£€æŸ¥ `is_applicant` æ˜¯å¦ä¸º0

3. **é€€ç¥¨**
   - æ‰§è¡Œ `updateStatusByInvitationCode()` 
   - æŸ¥çœ‹åŒé‚€è¯·ç çš„æ‰€æœ‰è®¢å•çŠ¶æ€æ˜¯å¦éƒ½å˜ä¸º"å·²é€€ç¥¨"

### æ—¶é—´å†²çªæ£€æŸ¥

1. åœ¨ `AdminService.approveOrder()` ä¸­æ·»åŠ æ—¥å¿—
2. æŸ¥çœ‹ `checkTimeConflict()` è¿”å›å€¼
3. æ£€æŸ¥æ•°æ®åº“ä¸­è¯¥è½¦è¾†çš„å…¶ä»–è®¢å•æ—¶é—´æ®µ

---

## ğŸ“Š æ•°æ®åº“æŸ¥è¯¢

### å¸¸ç”¨æŸ¥è¯¢

```sql
-- æŸ¥çœ‹æŸä¸ªå­¦ç”Ÿçš„æ‰€æœ‰è®¢å•
SELECT * FROM t_order WHERE student_id = '2023001' ORDER BY order_id DESC;

-- æŸ¥çœ‹æŸä¸ªé‚€è¯·ç çš„æ‰€æœ‰è®¢å•
SELECT * FROM t_order WHERE invitation_code = 'ABC12345';

-- æŸ¥çœ‹æŸè¾†è½¦åœ¨ç‰¹å®šæ—¶é—´çš„è®¢å•
SELECT * FROM t_order 
WHERE bus_id = 1 
  AND status = 'å·²é€šè¿‡'
  AND start_time < '2024-12-10 20:00:00'
  AND end_time > '2024-12-10 15:00:00';

-- ç»Ÿè®¡å„çŠ¶æ€çš„è®¢å•æ•°
SELECT status, COUNT(*) as count FROM t_order GROUP BY status;
```

---

## ğŸ” æƒé™æ£€æŸ¥æ¸…å•

### å­¦ç”Ÿç«¯

| æ“ä½œ | æƒé™è¦æ±‚ | æ£€æŸ¥ä½ç½® |
|------|---------|---------|
| åˆ›å»ºè®¢å• | ç™»å½• | Controller |
| æ”¯ä»˜è®¢å• | æ˜¯ç”³è¯·äºº, status=å®¡æ ¸ä¸­ | Service |
| åŠ å…¥æ‹¼è½¦ | ç™»å½•, æœªåŠ å…¥è¿‡ | Service |
| ç”³è¯·é€€ç¥¨ | isApplicant=1 | Service |
| ç¦»å¼€è®¢å• | isApplicant=0 | Service |

### ç®¡ç†å‘˜ç«¯

| æ“ä½œ | æƒé™è¦æ±‚ | æ£€æŸ¥ä½ç½® |
|------|---------|---------|
| æŸ¥çœ‹è®¢å• | ç®¡ç†å‘˜ç™»å½• | Controller |
| å®¡æ ¸é€šè¿‡ | æ— æ—¶é—´å†²çª | Service |
| å®¡æ ¸æ‹’ç» | æ— ç‰¹æ®Šè¦æ±‚ | Service |
| æ’¤é”€è®¢å• | status=å·²é€šè¿‡ | Service |

---

## ğŸ“± APIåˆ†ç»„

### è®¤è¯æ¥å£
- `POST /auth/student/login` - å­¦ç”Ÿç™»å½•
- `POST /auth/student/register` - å­¦ç”Ÿæ³¨å†Œ
- `POST /auth/admin/login` - ç®¡ç†å‘˜ç™»å½•

### å­¦ç”Ÿä¸šåŠ¡
- `POST /student/order` - åˆ›å»ºè®¢å•
- `GET /student/orders/{studentId}` - è·å–æˆ‘çš„è®¢å•
- `POST /student/order/pay/{orderId}` - æ”¯ä»˜
- `POST /student/order/calculate-price` - è®¡ç®—ä»·æ ¼
- `GET /student/order/by-invitation-code/{code}` - æŸ¥è¯¢é‚€è¯·ç 
- `POST /student/order/join-by-invitation-code/{code}` - åŠ å…¥æ‹¼è½¦
- `POST /student/order/refund/{orderId}` - ç”³è¯·é€€ç¥¨
- `POST /student/order/leave/{orderId}` - ç¦»å¼€è®¢å•
- `GET /student/profile/{studentId}` - è·å–ä¸ªäººä¿¡æ¯
- `PUT /student/profile/{studentId}` - ä¿®æ”¹ä¸ªäººä¿¡æ¯
- `GET /student/bus/{busId}` - è·å–è½¦è¾†è¯¦æƒ…

### ç®¡ç†å‘˜ä¸šåŠ¡
- `GET /admin/orders` - è·å–è®¢å•åˆ—è¡¨
- `POST /admin/order/approve` - å®¡æ ¸é€šè¿‡
- `POST /admin/order/reject` - å®¡æ ¸æ‹’ç»
- `POST /admin/order/revoke` - æ’¤é”€è®¢å•
- `GET /admin/buses` - è·å–è½¦è¾†åˆ—è¡¨
- `POST /admin/bus` - æ·»åŠ è½¦è¾†
- `DELETE /admin/bus/{busId}` - åˆ é™¤è½¦è¾†
- `POST /admin/bus/availability` - æ£€æŸ¥å¯ç”¨æ€§

---

## ğŸ› ï¸ é¡¹ç›®é…ç½®

### åç«¯
- **æ¡†æ¶**: Spring Boot 3.4.12
- **JDK**: Java 17
- **æ•°æ®åº“**: MySQL 5.7+
- **ORM**: MyBatis 3.0.3
- **æ„å»º**: Maven

### å‰ç«¯
- **æ¡†æ¶**: Vue 3.5.25
- **è·¯ç”±**: Vue Router 4.6.3
- **UIåº“**: Element Plus 2.11.9
- **HTTP**: Axios 1.13.2
- **æ„å»º**: Vite 7.2.4
- **Node**: ^20.19.0 or >=22.12.0

---

## ğŸ“ å¸¸è§é—®é¢˜

**Q: é‚€è¯·ç é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ**  
A: 8ä½ï¼ŒåŒ…å« A-Z å’Œ 0-9

**Q: åŒä¸€é‚€è¯·ç èƒ½è¢«å¤šå°‘äººä½¿ç”¨ï¼Ÿ**  
A: æ— é™åˆ¶ï¼Œå¯ä»¥å¤šä¸ªå­¦ç”ŸåŠ å…¥åŒä¸€é‚€è¯·ç 

**Q: ç”³è¯·äººé€€ç¥¨åï¼ŒåŠ å…¥è€…èƒ½çœ‹åˆ°å—ï¼Ÿ**  
A: èƒ½çœ‹åˆ°ï¼Œè®¢å•çŠ¶æ€å˜ä¸º"å·²é€€ç¥¨"

**Q: èƒ½å¦åŠ å…¥å·²æ‹’ç»çš„è®¢å•ï¼Ÿ**  
A: ä¸èƒ½ï¼Œåªæœ‰"å·²é€šè¿‡"çš„è®¢å•æ‰èƒ½åŠ å…¥

**Q: æ—¶é—´å†²çªæ£€æŸ¥çš„æ—¶é—´èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿ**  
A: æ–°è®¢å• start_time < ç°æœ‰è®¢å• end_time AND æ–°è®¢å• end_time > ç°æœ‰è®¢å• start_time

---

## ğŸ“– æ¨èé˜…è¯»é¡ºåº

1. æ–°æ‰‹ï¼šREADME.md â†’ CODE_DOCUMENTATION.md çš„"æŠ€æœ¯æ ˆ"å’Œ"æ ¸å¿ƒä¸šåŠ¡é€»è¾‘"ç« èŠ‚
2. å¼€å‘ï¼šCODE_DOCUMENTATION.md çš„å®Œæ•´æ–‡æ¡£ â†’ ç›¸å…³æºä»£ç æ–‡ä»¶
3. ç»´æŠ¤ï¼šä»£ç æ³¨é‡Šå®ŒæˆæŠ¥å‘Š.md â†’ å„ä¸ªæºä»£ç æ–‡ä»¶çš„JavaDocæ³¨é‡Š
4. éƒ¨ç½²ï¼šdoc/å¦‚ä½•åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½²springbootåç«¯.md

---

**æœ€åæ›´æ–°**ï¼š2025å¹´12æœˆ12æ—¥  
**ç‰ˆæœ¬**ï¼š1.0
